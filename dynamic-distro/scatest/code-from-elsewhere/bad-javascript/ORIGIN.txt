https://gist.github.com/bakkot/24c28836580a94989084